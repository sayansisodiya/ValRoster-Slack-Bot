{
  "info": {
    "_postman_id": "b5072e83-1021-4f89-96e5-894cb526d70a",
    "name": "ValBot Get Roster",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "name": "teams",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "a0006da4-3c35-4a85-98e6-ce5ace7614c4",
            "exec": [
              "try {",
              "  const response = pm.response.json()[0].players;",
              "",
              "    // {",
              "    //     \"type\": \"section\",",
              "    //     \"text\": {",
              "    //         \"type\": \"mrkdwn\",",
              "    //         \"text\": \"{{p0name}}\"",
              "    //     },",
              "    //     \"accessory\": {",
              "    //         \"type\": \"image\",",
              "    //         \"image_url\": \"{{p0pic}}\",",
              "    //         \"alt_text\": \"player 0\"",
              "    //     }",
              "    // }",
              "    var roster = [];",
              "",
              "    var teamHeader = {",
              "        \"type\": \"section\",",
              "        \"text\": {",
              "            \"type\": \"mrkdwn\",",
              "            \"text\": `:video_game: Team Found! :video_game:\\n\\n\\n                                                             *${pm.collectionVariables.get(\"team_param\")}*`",
              "        },",
              "        \"accessory\": {",
              "            \"type\": \"image\",",
              "            \"image_url\": pm.response.json()[0].image_url,",
              "            \"alt_text\": \"logo\"",
              "        }",
              "    }",
              "",
              "    roster.push(teamHeader);",
              "",
              "    var divider = {",
              "        \"type\": \"divider\"",
              "    }",
              "",
              "    roster.push(divider);",
              "",
              "    var rosterPlayerData;",
              "    ",
              "    response.forEach((player) => {",
              "",
              "        if(!player.image_url) {",
              "            var image2 = JSON.stringify(player.image_url);",
              "        } else {",
              "            var image2 = player.image_url;",
              "        }",
              "",
              "        rosterPlayerData = {",
              "\t\t\t\"type\": \"section\",",
              "\t\t\t\"text\": {",
              "\t\t\t\t\"type\": \"mrkdwn\",",
              "\t\t\t\t\"text\": player.name",
              "\t\t\t},",
              "\t\t\t\"accessory\": {",
              "\t\t\t\t\"type\": \"image\",",
              "\t\t\t\t\"image_url\": image2,",
              "\t\t\t\t\"alt_text\": \"player\"",
              "\t\t\t}",
              "\t\t}",
              "",
              "        roster.push(rosterPlayerData);",
              "    });",
              "",
              "    console.log(roster);",
              "",
              "    pm.collectionVariables.set(\"roster\", JSON.stringify(roster));",
              "",
              "    postman.setNextRequest(\"Send Roster\");",
              "",
              "} catch (error) {",
              "    console.log(\"error\");",
              "    postman.setNextRequest(\"Send Team Error Message\");",
              "}"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "id": "5c567eab-8d46-4fe3-b9d5-5124bde7ccbc",
            "exec": [
              "var previousRequest = JSON.parse(globals.previousRequest)",
              "var webhookRequestData = previousRequest.data;",
              "",
              "var teamName = webhookRequestData.text;",
              "",
              "// webhookRequestData contains the data sent to your webhook.",
              "console.log(webhookRequestData);",
              "",
              "pm.collectionVariables.set(\"team_param\", teamName);",
              "console.log(\"teamName: \" + teamName);",
              "console.log(\"team_param: \" + pm.collectionVariables.get(\"team_param\"));"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "id": "010930cf-e9b4-4703-b4e0-72c8d71576e7",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "https://api.pandascore.co/valorant/teams?token={{pandascore_token}}&filter[name]={{team_param}}",
          "protocol": "https",
          "host": [
            "api",
            "pandascore",
            "co"
          ],
          "path": [
            "valorant",
            "teams"
          ],
          "query": [
            {
              "key": "token",
              "value": "{{pandascore_token}}"
            },
            {
              "key": "filter[name]",
              "value": "{{team_param}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Send Roster",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "47fefc37-86ee-4d9b-8656-e44d64822846",
            "exec": [
              "postman.setNextRequest(null);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "id": "e9abe85a-3842-4946-b98c-9839856d9fbe",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"text\": \":video_game: Team Found! :video_game:\",\n\t\"blocks\": {{roster}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "{{slack_incoming_webhook_url}}"
      },
      "response": []
    },
    {
      "name": "Send Team Error Message",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "47fefc37-86ee-4d9b-8656-e44d64822846",
            "exec": [
              "postman.setNextRequest(null);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "id": "a588ab57-4d95-4b48-82df-4ec11fee27f7",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"text\": \"Please type the name of a professional Valorant team after `/roster`\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "{{slack_incoming_webhook_url}}"
      },
      "response": []
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "id": "9a1d0fb9-a675-4be5-87d3-a6f23742ee98",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "id": "107359fb-e2ff-44c6-b3b0-2c767d6c7498",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "id": "4311bfdf-3faf-49b6-a279-1c543977c788",
      "key": "pandascore_token",
      "value": "enter-pandascore-token-here"
    },
    {
      "id": "fa2626be-7e5e-48b3-8c53-13a8d9337eda",
      "key": "slack_incoming_webhook_url",
      "value": "enter-slack-webhook-url-here"
    }
  ]
}