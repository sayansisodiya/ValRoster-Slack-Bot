{
  "info": {
    "_postman_id": "71695fd8-283d-464e-8433-d51128b8f75b",
    "name": "ValBot Get Player",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "name": "players",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "e423dda3-28de-401f-b949-6ec1776be62b",
            "exec": [
              "var previousRequest = JSON.parse(globals.previousRequest)",
              "var webhookRequestData = previousRequest.data;",
              "",
              "var playerName = webhookRequestData.text;",
              "",
              "// webhookRequestData contains the data sent to your webhook.",
              "console.log(webhookRequestData);",
              "",
              "pm.collectionVariables.set(\"name_param\", playerName);",
              "console.log(\"playerName: \" + playerName);",
              "console.log(\"name_param: \" + pm.collectionVariables.get(\"name_param\"));"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "a5292587-ef81-4c4f-b27e-009d45c95b8b",
            "exec": [
              "try {",
              "    const response = pm.response.json()[0];",
              "    ",
              "    var player = [];",
              "",
              "    var playerHeader = {",
              "        \"type\": \"section\",",
              "        \"text\": {",
              "            \"type\": \"mrkdwn\",",
              "            \"text\": `:joystick: Player Found! :joystick:\\n\\n\\n                                                           \\\"*${pm.collectionVariables.get(\"name_param\")}*\\\"`",
              "        },",
              "        \"accessory\": {",
              "            \"type\": \"image\",",
              "            \"image_url\": response.image_url,",
              "            \"alt_text\": \"player\"",
              "        }",
              "    }",
              "",
              "    player.push(playerHeader);",
              "",
              "    var playerInfo = {",
              "        \"type\": \"section\",",
              "        \"fields\": [",
              "            {",
              "                \"type\": \"mrkdwn\",",
              "                \"text\": \"*First Name:*\"",
              "            },",
              "            {",
              "                \"type\": \"mrkdwn\",",
              "                \"text\": response.first_name",
              "            },",
              "            {",
              "                \"type\": \"mrkdwn\",",
              "                \"text\": \"*Last Name:*\"",
              "            },",
              "            {",
              "                \"type\": \"mrkdwn\",",
              "                \"text\": response.last_name",
              "            },",
              "            {",
              "                \"type\": \"mrkdwn\",",
              "                \"text\": \"*Birthday:*\"",
              "            },",
              "            {",
              "                \"type\": \"mrkdwn\",",
              "                \"text\": response.birthday",
              "            },",
              "            {",
              "                \"type\": \"mrkdwn\",",
              "                \"text\": \"*Team:*\"",
              "            },",
              "            {",
              "                \"type\": \"mrkdwn\",",
              "                \"text\": response.current_team.name",
              "            }",
              "        ]",
              "    }",
              "",
              "    player.push(playerInfo);",
              "",
              "    var logo = {",
              "        \"type\": \"context\",",
              "        \"elements\": [",
              "            {",
              "                \"type\": \"image\",",
              "                \"image_url\": response.current_team.image_url,",
              "                \"alt_text\": \"logo\"",
              "            }",
              "        ]",
              "    }",
              "",
              "    player.push(logo);",
              "",
              "    pm.collectionVariables.set(\"player\", JSON.stringify(player));",
              "",
              "    postman.setNextRequest(\"Send Player Info\");",
              "    ",
              "} catch (error) {",
              "    console.log(\"error\");",
              "    postman.setNextRequest(\"Send Player Error Message\");",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "b2d09b2e-800e-4104-abf0-8d8e74a41b3f",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "https://api.pandascore.co/valorant/players?token={{pandascore_token}}&filter[name]={{name_param}}",
          "protocol": "https",
          "host": [
            "api",
            "pandascore",
            "co"
          ],
          "path": [
            "valorant",
            "players"
          ],
          "query": [
            {
              "key": "token",
              "value": "{{pandascore_token}}"
            },
            {
              "key": "filter[name]",
              "value": "{{name_param}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Send Player Info",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "47fefc37-86ee-4d9b-8656-e44d64822846",
            "exec": [
              "postman.setNextRequest(null);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "57f4a61e-95b2-4bb3-bdfb-1be994d673b9",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"text\": \":joystick: Player Found! :joystick:\",\n    \"blocks\": {{player}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "{{slack_incoming_webhook_url}}"
      },
      "response": []
    },
    {
      "name": "Send Player Error Message",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "47fefc37-86ee-4d9b-8656-e44d64822846",
            "exec": [
              "postman.setNextRequest(null);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "3b33789e-6788-46c7-b5dd-355e63910a01",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"text\": \"Please type the name of a professional Valorant player after `/player`\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "{{slack_incoming_webhook_url}}"
      },
      "response": []
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "id": "625ef28e-9fd7-425a-84a8-b3f90410ba46",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "id": "15d13216-7fd4-424d-8b20-be7eb6216032",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "id": "768f5ba7-9681-46b3-b3ab-b913038b7637",
      "key": "pandascore_token",
      "value": "",
      "type": "string"
    },
    {
      "id": "8480013c-96d9-4c05-a622-cf87a9a6793e",
      "key": "slack_incoming_webhook_url",
      "value": "",
      "type": "string"
    }
  ]
}